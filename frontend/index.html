<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turjuman - LLM Powered Books  & Long Text Translator</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script> <!-- Tailwind CSS via CDN -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script> <!-- Alpine.js via CDN -->
    <link rel="stylesheet" href="/static/css/style.css"> <!-- Link to custom styles -->
    <style>
        /* Basic theme variables */
        .theme-light { --bg-primary: #ffffff; --text-primary: #111827; --bg-secondary: #f9fafb; --bg-tertiary: #f3f4f6; --border-color: #e5e7eb; --text-muted: #6b7280; --link-color: #4f46e5; }
        .theme-dark { --bg-primary: #1f2937; --text-primary: #f3f4f6; --bg-secondary: #374151; --bg-tertiary: #4b5563; --border-color: #4b5563; --text-muted: #9ca3af; --link-color: #818cf8; }
        .theme-yellow { --bg-primary: #fefce8; --text-primary: #422006; --bg-secondary: #fef9c3; --bg-tertiary: #fef3c7; --border-color: #fde68a; --text-muted: #7c2d12; --link-color: #c2410c; }
        .theme-grey { --bg-primary: #f3f4f6; --text-primary: #222222; --bg-secondary: #e5e7eb; --bg-tertiary: #d1d5db; --border-color: #9ca3af; --text-muted: #6b7280; --link-color: #374151; }

        .theme-cyberpunk-magenta {
            --bg-primary: #120018;
            --text-primary: #ff33ff;
            --bg-secondary: #1a002a;
            --bg-tertiary: #2a003a;
            --border-color: #ff00cc;
            --text-muted: #ff99ff;
            --link-color: #00fff7;
        }
        .theme-cyberpunk-red {
            --bg-primary: #120008;
            --text-primary: #ff3333;
            --bg-secondary: #1a000a;
            --bg-tertiary: #2a001a;
            --border-color: #ff2222;
            --text-muted: #ff8888;
            --link-color: #ff3333;
        }
        .theme-cyberpunk-cyan {
            --bg-primary: #061826;
            --text-primary: #00fff7;
            --bg-secondary: #0a2233;
            --bg-tertiary: #112d44;
            --border-color: #00fff7;
            --text-muted: #ff33ff;
            --link-color: #00bfff;
        }
        body { background-color: var(--bg-primary); color: var(--text-primary); transition: background-color 0.3s, color 0.3s; font-family: 'Orbitron', 'Share Tech Mono', 'Consolas', monospace, sans-serif; }
        .theme-cyberpunk-cyan .card, .theme-cyberpunk-cyan .tab, .theme-cyberpunk-cyan input, .theme-cyberpunk-cyan select, .theme-cyberpunk-cyan textarea, .theme-cyberpunk-cyan pre {
            box-shadow: 0 0 8px #00fff7, 0 0 2px #ff33ff;
            border: 2px solid var(--border-color) !important;
            background-color: var(--bg-secondary) !important;
            color: var(--text-primary) !important;
            text-shadow: 0 0 4px #00fff7, 0 0 2px #ff33ff;
        }
        .theme-cyberpunk-cyan label {
            color: var(--text-muted) !important;
            text-shadow: 0 0 2px #00fff7;
        }
        .theme-cyberpunk-cyan .tab.active {
            border-bottom-color: var(--link-color);
            color: var(--link-color);
            font-weight: 700;
            text-shadow: 0 0 6px #00fff7;
        }
        .theme-cyberpunk-cyan .spinner {
            border-top: 4px solid var(--link-color);
            border: 4px solid var(--bg-tertiary);
        }
        .theme-cyberpunk-cyan body, body.theme-cyberpunk-cyan {
            background-image: repeating-linear-gradient(0deg, #00fff722 0 1px, transparent 1px 40px), repeating-linear-gradient(90deg, #00fff722 0 1px, transparent 1px 40px);
        }
        .theme-cyberpunk-magenta .card, .theme-cyberpunk-magenta .tab, .theme-cyberpunk-magenta input, .theme-cyberpunk-magenta select, .theme-cyberpunk-magenta textarea, .theme-cyberpunk-magenta pre {
            box-shadow: 0 0 8px #ff00cc, 0 0 2px #00fff7;
            border: 2px solid var(--border-color) !important;
            background-color: var(--bg-secondary) !important;
            color: var(--text-primary) !important;
            text-shadow: 0 0 4px #ff33ff, 0 0 2px #00fff7;
        }
        .theme-cyberpunk-magenta label {
            color: var(--text-muted) !important;
            text-shadow: 0 0 2px #ff33ff;
        }
        .theme-cyberpunk-magenta .tab.active {
            border-bottom-color: var(--link-color);
            color: var(--link-color);
            font-weight: 700;
            text-shadow: 0 0 6px #00fff7;
        }
        .theme-cyberpunk-magenta .spinner {
            border-top: 4px solid var(--link-color);
            border: 4px solid var(--bg-tertiary);
        }
        .theme-cyberpunk-magenta body, body.theme-cyberpunk-magenta {
            background-image: repeating-linear-gradient(0deg, #ff00cc22 0 1px, transparent 1px 40px), repeating-linear-gradient(90deg, #ff00cc22 0 1px, transparent 1px 40px);
        }
        .theme-cyberpunk-red .card, .theme-cyberpunk-red .tab, .theme-cyberpunk-red input, .theme-cyberpunk-red select, .theme-cyberpunk-red textarea, .theme-cyberpunk-red pre {
            box-shadow: 0 0 8px #ff2222, 0 0 2px #ff3333;
            border: 2px solid var(--border-color) !important;
            background-color: var(--bg-secondary) !important;
            color: var(--text-primary) !important;
            text-shadow: 0 0 4px #ff3333, 0 0 2px #ff2222;
        }
        .theme-cyberpunk-red label {
            color: var(--text-muted) !important;
            text-shadow: 0 0 2px #ff3333;
        }
        .theme-cyberpunk-red .tab.active {
            border-bottom-color: var(--link-color);
            color: var(--link-color);
            font-weight: 700;
            text-shadow: 0 0 6px #ff3333;
        }
        .theme-cyberpunk-red .spinner {
            border-top: 4px solid var(--link-color);
            border: 4px solid var(--bg-tertiary);
        }
        .theme-cyberpunk-red body, body.theme-cyberpunk-red {
            background-image: repeating-linear-gradient(0deg, #ff222222 0 1px, transparent 1px 40px), repeating-linear-gradient(90deg, #ff222222 0 1px, transparent 1px 40px);
        }
        .card { background-color: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 0.5rem; padding: 1rem; margin-bottom: 1rem; }
        .tab { padding: 0.5rem 1rem; cursor: pointer; border-bottom: 2px solid transparent; color: var(--text-muted); }
        .tab.active { border-bottom-color: var(--link-color); color: var(--text-primary); font-weight: 600; }
        label { color: var(--text-muted); }
        input, select, textarea { background-color: var(--bg-primary) !important; border-color: var(--border-color) !important; color: var(--text-primary) !important; }
        textarea:disabled { background-color: var(--bg-tertiary) !important; }
        pre { background-color: var(--bg-tertiary); padding: 0.5rem; border-radius: 0.25rem; border: 1px solid var(--border-color); white-space: pre-wrap; word-wrap: break-word; }
        /* Basic spinner */
        .spinner { border: 4px solid var(--bg-tertiary); border-top: 4px solid var(--link-color); border-radius: 50%; width: 1.25rem; height: 1.25rem; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body x-data="translationApp()" x-init="init()" :class="`theme-${theme}`" class="p-4 md:p-6">

    <div class="max-w-7xl mx-auto">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-3xl font-bold">Turjuman - LLM Powered Books  & Long Text Translator</h1>
            <!-- Theme Switcher -->
            <div>
                <label for="theme-select" class="text-sm font-medium sr-only">Theme:</label>
                <select id="theme-select" x-model="theme" class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                    <option value="yellow">Yellow</option>
                    <option value="grey">Grey</option>
                    <option value="cyberpunk-magenta">Cyberpunk - Magenta</option>
                    <option value="cyberpunk-red">Cyberpunk - Red</option>
                    <option value="cyberpunk-cyan">Cyberpunk - Cyan</option>
                </select>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- Left Column: Configuration & Input -->
            <div class="lg:col-span-1 space-y-4">
                <div class="card">
                    <h2 class="text-xl font-semibold mb-3">Configuration</h2>
                    <div class="space-y-3">
                        <div>
                            <label for="api_url" class="block text-sm font-medium">API URL:</label>
                            <input type="text" id="api_url" x-model="apiUrl" class="mt-1 block w-full rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="source_lang" class="block text-sm font-medium">Source Language:</label>
                            <input type="text" id="source_lang" x-model="inputData.config.source_lang" class="mt-1 block w-full rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="e.g., english">
                        </div>
                        <div>
                            <label for="target_lang" class="block text-sm font-medium">Target Language:</label>
                            <input type="text" id="target_lang" x-model="inputData.config.target_lang" class="mt-1 block w-full rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="e.g., arabic">
                        </div>
                        <div>
                            <label for="target_accent" class="block text-sm font-medium">Target Style/Accent:</label>
                            <input type="text" id="target_accent" x-model="inputData.config.target_language_accent" class="mt-1 block w-full rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="e.g., professional, Egyptian Arabic">
                        </div>
                        <div>
                            <label for="provider" class="block text-sm font-medium">Provider:</label>
                            <select id="provider" x-model="inputData.config.provider" @change="updateModels" class="mt-1 block w-full rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                <option value="">Select Provider</option>
                                <template x-for="providerName in Object.keys(availableProviders)" :key="providerName">
                                    <option :value="providerName" x-text="providerName"></option>
                                </template>
                            </select>
                        </div>
                         <div>
                            <label for="model_filter" class="block text-sm font-medium">Filter Models:</label>
                            <input type="text" id="model_filter" x-model="modelFilter" @input="updateModels" class="mt-1 block w-full rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Filter models...">
                        </div>
                        <div>
                            <label for="model" class="block text-sm font-medium">Model:</label>
                            <select id="model" x-model="inputData.config.model" :disabled="!inputData.config.provider" class="mt-1 block w-full rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm disabled:opacity-50">
                                <option value="">Select Model</option>
                                <template x-for="model in availableModels" :key="model">
                                    <option :value="model" x-text="model"></option>
                                </template>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2 class="text-xl font-semibold mb-3">Input Content</h2>
                     <div>
                        <label for="file-upload" class="block text-sm font-medium mb-1">Upload File (.md, .txt):</label>
                        <input id="file-upload" type="file" @change="handleFileUpload($event)" accept=".md,.markdown,.txt" class="block w-full text-sm text-[var(--text-muted)] file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-[var(--bg-tertiary)] file:text-[var(--text-primary)] hover:file:bg-opacity-80">
                    </div>
                    <div class="mt-2">
                        <label for="original_content" class="block text-sm font-medium">Or Paste Text:</label>
                        <textarea id="original_content" x-model="inputData.original_content" rows="15" class="mt-1 block w-full rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Paste your text here or upload a file..."></textarea>
                    </div>
                    <button @click="startTranslation" :disabled="isLoading || !canStartTranslation()" class="mt-4 w-full inline-flex justify-center items-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed">
                        <span x-show="!isLoading">Start Translation</span>
                        <div x-show="isLoading" class="spinner mr-2"></div>
                        <span x-show="isLoading">Translating...</span>
                    </button>
                </div>
            </div>

            <!-- Right Column: Status & Results -->
            <div class="lg:col-span-2 space-y-4">
                <div class="card" x-show="jobId || isLoading">
                    <h2 class="text-xl font-semibold mb-3">Translation Status</h2>
                    <div x-show="jobId">Job ID: <code class="text-sm" x-text="jobId"></code></div>
                    <div x-show="isLoading || status.progress_percent > 0">
                        <p class="mb-1 mt-2">Completed Step: <strong x-text="status.current_step || (isLoading ? 'Initializing...' : 'Done')"></strong></p>
                        <!-- Translation Stage Graph -->
                        <div class="w-full bg-[var(--bg-tertiary)] rounded-full h-2.5 mb-2">
                            <div class="bg-blue-600 h-2.5 rounded-full transition-all duration-300" :style="`width: ${status.progress_percent || 0}%`"></div>
                        </div>
                        <p class="text-sm text-right mb-2"><span x-text="status.progress_percent ? status.progress_percent.toFixed(1) : '0.0'"></span>%</p>
                        <p class="text-sm" x-show="status.final_document || status.error_info">Duration: <span x-text="translationDuration"></span></p>
                    </div>
                     <div x-show="status.error_info" class="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded">
                        <h3 class="text-md font-semibold mb-1">Error:</h3>
                        <p class="text-sm" x-text="status.error_info"></p>
                    </div>
                </div>

                <template x-if="isLoading || status.final_document">
                    <div>
                        <!-- Results Card Header (only for downloads, shown when translation is complete) -->
                        <div class="card" x-show="status.final_document">
                            <div class="flex justify-between items-center mb-3">
                                 <h2 class="text-xl font-semibold">Results</h2>
                                 <div class="flex space-x-2">
                                     <button @click="downloadFile(cleanedTranslatedContent, 'translated.md', 'text/markdown')" class="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                         Download translated file (.MD)
                                     </button>
                                     <button @click="downloadFile(JSON.stringify(status, null, 2), 'response.json', 'application/json')" class="inline-flex items-center px-3 py-1 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-[var(--text-primary)] bg-[var(--bg-tertiary)] hover:bg-opacity-80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                         Download JSON Response
                                     </button>
                                 </div>
                            </div>
                        </div>

                        <!-- Tabs Navigation -->
                        <div class="card">
                            <div class="border-b border-[var(--border-color)] mb-4">
                                <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                                    <button @click="activeTab = 'full'" :class="{'active': activeTab === 'full'}" class="tab">Full Document</button>
                                    <button @click="activeTab = 'chunks'" :class="{'active': activeTab === 'chunks'}" class="tab">Chunk Pairs</button>
                                    <button @click="activeTab = 'logs'" :class="{'active': activeTab === 'logs'}" class="tab">Logs</button>
                                </nav>
                            </div>

                            <!-- Tab Content -->
                            <div>
                                <!-- Full Document View -->
                                <div x-show="activeTab === 'full'">
                                    <template x-if="!status.final_document">
                                        <div class="p-6 text-center text-[var(--text-muted)]">
                                            <span class="text-lg font-semibold">Translation in progress .. will update when complete, in meanwhile view the realtime translated chunks or logs for more details</span>
                                        </div>
                                    </template>
                                    <template x-if="status.final_document">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <div class="flex justify-between items-baseline mb-1">
                                                    <h3 class="text-lg font-semibold">Original</h3>
                                                    <span class="text-xs text-[var(--text-muted)]" x-text="`Words: ${countWords(cleanedOriginalContent)} | Chars: ${cleanedOriginalContent.length}`"></span>
                                                </div>
                                                <textarea readonly :dir="isRtl(inputData.config.source_lang) ? 'rtl' : 'ltr'" x-text="cleanedOriginalContent" rows="20" class="w-full rounded-md shadow-sm sm:text-sm disabled:opacity-100"></textarea>
                                            </div>
                                            <div>
                                                <div class="flex justify-between items-baseline mb-1">
                                                    <h3 class="text-lg font-semibold">Translated</h3>
                                                     <span class="text-xs text-[var(--text-muted)]" x-text="`Words: ${countWords(cleanedTranslatedContent)} | Chars: ${cleanedTranslatedContent.length}`"></span>
                                                </div>
                                                <div :dir="isRtl(inputData.config.target_lang) ? 'rtl' : 'ltr'" class="h-[410px] overflow-y-auto border border-[var(--border-color)] rounded-md p-2 bg-[var(--bg-tertiary)]">
                                                    <pre x-text="cleanedTranslatedContent"></pre>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>

                                <!-- Chunk Pairs View -->
                                <div x-show="activeTab === 'chunks'" class="space-y-4 max-h-[500px] overflow-y-auto">
                                    <template x-for="(origChunk, index) in status.chunks" :key="index">
                                        <div class="border-b border-[var(--border-color)] pb-4">
                                            <h4 class="text-md font-semibold mb-2">Chunk Pair <span x-text="index + 1"></span></h4>
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <h5 class="text-sm font-medium text-[var(--text-muted)] mb-1">Original</h5>
                                                    <pre :dir="isRtl(inputData.config.source_lang) ? 'rtl' : 'ltr'" x-text="cleanMarkdown(origChunk || '')"></pre>
                                                </div>
                                                <div>
                                                    <h5 class="text-sm font-medium text-[var(--text-muted)] mb-1">Translated</h5>
                                                    <pre :dir="isRtl(inputData.config.target_lang) ? 'rtl' : 'ltr'" x-text="cleanMarkdown(translatedChunks[index] || '')"></pre>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                     <p x-show="!status.chunks || status.chunks.length === 0">No chunk data available.</p>
                                </div>

                                <!-- Logs View -->
                                <div x-show="activeTab === 'logs'">
                                    <h3 class="text-lg font-semibold mb-2">Logs</h3>
                                    <div class="max-h-96 overflow-y-auto bg-[var(--bg-tertiary)] p-2 rounded border border-[var(--border-color)] text-sm font-mono">
                                        <template x-for="(log, index) in logs" :key="index">
                                            <div x-text="log"></div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
                                </template>
                                <p x-show="!logs || logs.length === 0">Start new translation request by selecting file or write some content</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card text-center text-[var(--text-muted)]" x-show="!isLoading && !jobId">
                    Upload a file or paste text, configure settings, and click "Start Translation".
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>